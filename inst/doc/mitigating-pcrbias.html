<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Example of using Fido for measuring and mitigating PCR Bias</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Example of using Fido for measuring and
mitigating PCR Bias</h1>



<p>If you have no already done so, I would read through our manuscript
<a href="https://www.biorxiv.org/content/10.1101/604025v1">Measuring and
Mitigating PCR Bias in Microbiome Data</a>. This vignette only discusses
the computational aspect of our approach, equally important is the
design of the PCR calibration curve which is detailed in the
manuscript.</p>
<div id="overview" class="section level1">
<h1>Overview</h1>
<p>PCR bias can be both measured and corrected by combining a specially
designed calibration curve with statistical models. The below figure
gives a brief overview of the calibration experiment. In brief, samples
are pooled to create a “calibration sample”. This calibration sample
then contains DNA from every taxa in your study. The calibration sample
is then split into multiple aliquots and amplified for a varying number
of cycles. You then sequence the resulting samples along with the
original samples. Then you turn to modeling (which is the focus of this
vignette).</p>
<p><img src="https://github.com/jsilve24/fido/raw/master/vignettes/pcrbias_summary_graphic.png" width="50%" style="display: block; margin: auto;" /></p>
<p>In the manuscript, we show that PCR bias is well approximated by a
simple multiplicative process. When translated to sequence count data,
this means that PCR bias represents a linear process in log-ratio space:
We just need multinomial logistic-normal linear models (aka
<code>pibble</code> models in the <em>fido</em> package). If we set our
model up correctly then PCR bias is just a linear model: There is a bias
parameter and the amount of bias seen for a given sample is that
parameter times the number of PCR cycles that sample underwent prior to
sequencing. In this case our estimate for the unbiased composition of
each sample just becomes a unique intercept for each sample (if you have
technical / biological replicates then the replicates will share an
intercept; we demonstrate that below as well). Another way to think
about this is we want to estimate the composition when the number of PCR
cycles is equal to zero (aka the intercept).</p>
</div>
<div id="an-example" class="section level1">
<h1>An Example</h1>
<p>Here I will show an example of how such data (including calibration
samples can be modeled). This is the mock community data we analyzed in
the manuscript.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(fido)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5903</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># First load the data</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">data</span>(pcrbias_mock)</span></code></pre></div>
<p>Lets first take a brief look at the data. There are two objects
<code>Y</code> (a count table that I already preprocessed just as in our
manuscript) and <code>metadata</code> which contains the covariates we
need (including the number of PCR cycles each sample has undergone).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt;               cycle13.1 cycle13.2 cycle13.3 cycle14.1 cycle14.2</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; B.longum             27        28        22        37        44</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; B.subtilis          320       299       272       513       650</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; C.aerofaciens        35        32        39        43        84</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; C.hathewayi          61        52        59        93       117</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; C.innocuum          121        91       112       197       208</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">head</span>(metadata)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;   sample_name  sample_num cycle_num machine</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; 1   cycle13.1 Calibration        13       3</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; 2   cycle13.2 Calibration        13       3</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; 3   cycle13.3 Calibration        13       3</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 4   cycle14.1 Calibration        14       4</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; 5   cycle14.2 Calibration        14       4</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; 6   cycle14.3 Calibration        14       4</span></span></code></pre></div>
<p>The only non-obvious variable here is probably <code>machine</code>
which just is a categorical variable denoting which of 4 different PCR
machines used to amplify a given sample. When writing the paper, we
thought this might be a source of bias so we included this as a term in
our model (we will do the same here just to demonstrate how).</p>
<p>As <em>fido</em> doesn’t yet have a formula interface (I will write
that eventually), you just need to use the formula interface provided by
base-R’s <code>model.matrix</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> cycle_num <span class="sc">+</span> sample_num <span class="sc">+</span> machine  <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> metadata))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>X[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;                        1  2  3  4  5</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; cycle_num             13 13 13 14 14</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; sample_numCalibration  1  1  1  1  1</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; sample_numMock1        0  0  0  0  0</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; sample_numMock10       0  0  0  0  0</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; sample_numMock2        0  0  0  0  0</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; sample_numMock3        0  0  0  0  0</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; sample_numMock4        0  0  0  0  0</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; sample_numMock5        0  0  0  0  0</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; sample_numMock6        0  0  0  0  0</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; sample_numMock7        0  0  0  0  0</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; sample_numMock8        0  0  0  0  0</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; sample_numMock9        0  0  0  0  0</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; machine2               0  0  0  0  0</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; machine3               1  1  1  0  0</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; machine4               0  0  0  1  1</span></span></code></pre></div>
<p>You can see that in doing this we have created a design matrix which
has encoded the PCR machine using a series of 3 dummy variables. We also
have a series of dummy variables denoting which samples are biologically
unique (e.g., <code>sample_num</code>). The <code>-1</code> in the
formula just tells R to have a unique intercept for each biological
sample (e.g., to use a one-hot-encoding rather than the dummy encoding
used for the PCR machines).</p>
<p>Next we are going to specify our model priors and fit the model. A
detailed description of the general thought process I like to follow
when creating priors in <em>fido</em> is provided in the vignette
<em>Tips for Specifying Priors</em>. Here I am just going to a simple
prior where I just change <code>Gamma</code> from its default values. If
you are wondering, in the manuscript I choose the multiplier 10 based on
maximum marginal likelihood. At the end of this vignette I will show an
example of how this can be done.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">pibble</span>(<span class="at">Y =</span> Y, <span class="at">X=</span>X, <span class="at">Gamma =</span> <span class="dv">10</span><span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(X)))</span></code></pre></div>
<p>Next we are going to transform the results into CLR coordinates and
interpret them in that space.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">to_clr</span>(fit)</span></code></pre></div>
<p>That’s about it. Now its just interpreting the model results. Lets
say you want to investigate the estimated unbiased composition, then you
just have to look at the inferred random intercepts for the
corresponding <code>sample_num</code> variable. We can plot the results
simply enough:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># pull out indices for random intercepts corresponding to `sample_num`</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>focus.covariate <span class="ot">&lt;-</span> <span class="fu">rownames</span>(X)[<span class="fu">which</span>(<span class="fu">grepl</span>(<span class="st">&quot;sample_num&quot;</span>, <span class="fu">rownames</span>(X)))]</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Also just so the plot fits nicely in Rmarkdown we are also going to just </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># plot a few of the taxa</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>focus.coord <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;clr_&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;S.gallolyticus&quot;</span>, <span class="st">&quot;R.intestinalis&quot;</span>, <span class="st">&quot;L.ruminis&quot;</span>)) </span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># Also to make the plot fit nicely, I just flip the orientation of the plot </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">par=</span><span class="st">&quot;Lambda&quot;</span>, <span class="at">focus.cov=</span>focus.covariate, <span class="at">focus.coord=</span>focus.coord) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.data<span class="sc">$</span>covariate<span class="sc">~</span>.)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; replace the existing scale.</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" width="50%" style="display: block; margin: auto;" /></p>
<p>The compositional bias introduced at each cycle can also be
visualized.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Also to make the plot fit nicely, I just flip the orientation of the plot </span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">par=</span><span class="st">&quot;Lambda&quot;</span>, <span class="at">focus.cov=</span><span class="st">&quot;cycle_num&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; replace the existing scale.</span></span></code></pre></div>
<p><img src="https://github.com/jsilve24/fido/raw/master/vignettes/pcr-results-cycle-num.png" width="50%" style="display: block; margin: auto;" /></p>
<p>The <em>fido</em> package has a bunch of tools for working with such
fitted models depending on what you ultimately want to do. See the main
<code>pibble</code> vignette for a fuller description of what you can do
with such fitted models.</p>
<p>One plot I find particularly useful, is visualizing the calibration
data and the fitted bias model. This can be done as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># First transform the data into CLR coordinates (requires pseudo-count to deal with</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># zeros). Then will convert to tidy format for ggplot </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>tidy_calibration <span class="ot">&lt;-</span> <span class="fu">clr_array</span>(Y<span class="fl">+0.5</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># transform to CLR</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;cycle&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># select only samples from the calibration</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>tidy_calibration<span class="sc">$</span>sample_name <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tidy_calibration)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>tidy_calibration <span class="ot">&lt;-</span> tidy_calibration <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="fu">gather</span>(coord, val, <span class="sc">-</span>sample_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coord =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(coord, <span class="dv">2</span>, <span class="dv">4</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata, <span class="at">by=</span><span class="st">&quot;sample_name&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coord =</span> <span class="fu">names_coords</span>(fit)[coord])</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co"># Now the important part - lets grab the pibble result of interest</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>X.tmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(X), <span class="dv">2</span>) <span class="co"># Create fake covariate data to predict the regression line based on </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="fu">rownames</span>(X.tmp) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(X)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>X.tmp[<span class="st">&quot;cycle_num&quot;</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">35</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>X.tmp[<span class="st">&quot;sample_numCalibration&quot;</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>X.tmp <span class="co"># simple, just going to predict the composition for each of these two samples</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt;                       [,1] [,2]</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; cycle_num                0   35</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt; sample_numCalibration    1    1</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; sample_numMock1          0    0</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt; sample_numMock10         0    0</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; sample_numMock2          0    0</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; sample_numMock3          0    0</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; sample_numMock4          0    0</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt; sample_numMock5          0    0</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; sample_numMock6          0    0</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="co">#&gt; sample_numMock7          0    0</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="co">#&gt; sample_numMock8          0    0</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co">#&gt; sample_numMock9          0    0</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co">#&gt; machine2                 0    0</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="co">#&gt; machine3                 0    0</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="co">#&gt; machine4                 0    0</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>      <span class="co"># for the plot</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co"># Now predict the fitted regression line for cycle_num using X.tmp</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata=</span>X.tmp, <span class="at">summary=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cycle_num =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>)[sample])</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="co"># now plot </span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>predicted <span class="sc">%&gt;%</span> </span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cycle_num)) <span class="sc">+</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>p2<span class="fl">.5</span>, <span class="at">ymax=</span>p97<span class="fl">.5</span>), <span class="at">fill=</span><span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean)) <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tidy_calibration, <span class="fu">aes</span>(<span class="at">y=</span>val)) <span class="sc">+</span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>  <span class="fu">facet_grid</span>(coord<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;CLR Coordinates&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbAAAAJACAMAAADb6sOcAAABZVBMVEUAAAAAADoAAGYAOmYAOpAAZrYZGT8ZGWIZP4EZYp8aGhozMzM6AAA6ADo6AGY6OmY6OpA6ZmY6kLY6kNs/GRk/Pz8/P2I/P4E/YmI/YoE/Yp8/gZ8/gb1NTU1NTY5NbqtNjshiGRliGT9iGWJiPz9iP4FiYj9iYmJiYoFigb1in9lmAABmADpmAGZmOgBmOjpmtttmtv9uTY5uq+SBPxmBPz+BP2KBYj+BgZ+BvdmOTU2OTY6ObquOyP+QOgCQOjqQOmaQ29uQ2/+fYhmfYj+fYmKfgWKfn2Kf2b2f2dmpqamrbk2rbo6r5P+2ZgC2/7a2//+9gT+9gWK9n2K9vYG9vdm92b292dnIjk3Ijm7IyP/I///Zn2LZn5/ZvYHZvb3Z2Z/Z2b3Z2dnbkDrbtmbb25Db/7bb/9vb///kq27kq47k///r6+v/tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T///+eabLkAAAACXBIWXMAAAsSAAALEgHS3X78AAAcEElEQVR4nO2djZ/cxlnHlxDbd3JfXHwmqTnTmtQNXTuAiQNcaZziczEXqOstLZuQ43y3JtAQOwbbvb8fzehl5+3RjKSRNM/u77E/p5U0+q12vnpGI+3sT7NzBKuYTb0DiHYBYMwCwJgFgDELL7DLiFQiEJg29zzwOAgtt7GCl1fRA8CGFBwf2Fcfl+8cYe8jFOQmODqwz24AWB/BsYG9/neZYeJU9xzRIdAkMhMEMGaCAMZMEMCYCeI6jJkggDETnBDY1B1knoEMYyYIYMwEAYyZIIAxExwb2O//+cYPy3eOsPcRCnITHBvYNx+ef1ZcOQNYp3JjA/ufXwpmuFvfOcYG9nkB7BwZxivDzgGMCTCcw3wFZ2bN+YEd79evsizbWWqLegJDL9FTcDYzibUClr96eBATmPLOnT5mavXbvlzNIwqws3vZpaPj/eNrl44qYL84ki/yNTvLPOMuHZ3evPjjeb5mMT9+d+/So6woCmBh5dZAnlcLzAKNggawnMPxbg5st5zNsoLH8f4iJySWL+aL+dm9EtjOciGWdAM2dQd53JjNqmn5qp5Ua9zrzTCAycrPge2vm8TFvnyRt4wn1yWm/NWiBLa/klNkmLdcnVjVC3NqFlQ20ITsDDt55191YHMlw/Zlhq0OBatDAFOCOjUZnKwFCphPRYh5c6rqmZ2Ow+zigZJhspd4emtZncMEntOb2bXiD4DVQSWEK5FIMOUKa70q2OE6TGZYw/rNBmb1CarFjhbOxaOOat4AtF69DvWNKGAne3lyXTxwrcqTS16bdQTGe9SUlUliGpAon5q83GjWoQqou4Gx9W0E27VkVuIQaPSMs3lqu4Gx9a6gksEDZD3fiKYh/Lu23QNJ/TVoHvguYO4GzdsUMrj5+9mNH3w9DbAAMhSvdY0TcNxE9MV9PsrUYzoGBRYAIGS+AYy/MxH4SbYMmJcMxYvuPGto1p3upk6G/15twEdpVy71UVMdwRCsghNnDdboXZuAthZYPDAUGw0IddlaTm0O9YKWN9cbgh2wwI50ezRN3WcHIPH21ZS6h07ePB892GRYazSuIO+V+1u6VC7tEwQWBQ1xlWMBsm6m1wWb642OLQHWA02rqxwLUPM9Xb9g53LMgfWC4/+YVhjfTvUXbF2OCbDXP73xp18U76wtD4UTuToc56p+ghsHLL9s/iqhgaQA5gOWxzcfJ3S3PpXeenCMD+z1z74uDpUIh1uEgtwER79b//rvvyjfGZFKkMDy+L+//iLwwEKMGwSwz27cuPHhuHuCCAqYNDMLAGMWcNXmE4HAtLlEOs3pC6ZyL3GqofC4l5j4MDfqpwhEuQ7vvGnAiJG/7b9T8dy9D/s+jPrm3wYZ/Z4jE2DUyF/3t5b9vsN0BDU0wDtEwFqwXhH5ZqEnUmkSQ2s7Qqjg/EPi7dE7xQ5TX1W3/kbUezZN8xwWIXtGZO4gv34HE3C1xg2iIm6RJ34hmAqwqUb+UvWsEqamUaBb5K092WhgXQXr47uY2MDIkaaeNtXKNGNFCFRtf7f1OswoZ9VLFesVxA/6jHLaeje4ZrKuqfpGAFZMqFO+CayhoHO9AyRxQWH2YoheTSojf5ONvt126zrBnPre0JhHho0j6GhzeVw4K+8cYe8jFBxLMNa9LgBjJghgzAThqs1MEI6kzAThqs0s4KrNTBCu2swEcQ5jJoheIjPBQBt0c+XTpXDBdHtt4zpsSMFAG3Rj5emtJW2NDmBDCgbaoJ/elMuFMfO1/NUi2y0yTC7vCGzqDjLPCLRBX8xXZ78tgO3mhaQLsPgnlyPDRhQMtEHPM0mYNxfW5yfXa2ByOYCNKBhog15hPDQybOU4lQHYkIKBNuiL4hkewvpcnMPO7pXnsEXW/RwWYe8jFOQmiFFTzAQ72KD3A8baVTsBwVTG1iMCA00iM8EtcdXeHEFkGDNBAGMmiFFTzAQBjJkgxtYzC2QYM0EAYyYIYMwEAYyZYCqu2olUR/qCW+6qzU9w21212QVctZkJwlUbAVdtlgFXbWYBk2ZmAWDMAq7afCIQmDaXSKc5fUHcS2QmiDEdzARTcdVOpDrSF8TIX2aBJpGZIIAxEwQwZoIAxkwQ12HMBAGMmSBG/jILZBgzQQBjJghgzAQBbCRBrr712+qXyPbJENvqSLoGRjzILVQQrtrjRP2wnPVTc4K31Gbhqh1J0JM41uOoQk92Uz+Oip2rdmAL5uMQ3CSagKYGxu0c5k2I0HKhvcTUgHHrJUYD5tjCI+SeXwNTjCqFlducwHGypxhaOn2aN+s6LLRTR5XzPquReiS795GK68o/fe9odfpnhPXegiK5mcBaZ46nz2CtoApQQCUwh5d2nWoXD05vZjvLfN0/3cunJ3sXD+TScptiZelXWmy+UXfr2/bCzfLk9tUKqgC1/HJJSPXSXifR02U+k8/KdYt9+X9eLC23qVfOa4Ptjcqwtte5vofE2sJy6noSeMODtx1e2qv/OCpSL5sfZpmwqRdPHDi5Lg3RxdJym2rlYl4bbG8WsJYFzZZOAeZ+RLs7Zko4gBle2uL8dXZPAMkZHVZo1hkml5bb1CvndVvKGhiVD4EF6Sek+7DooW7oujWle2mXvUThdZ5l74vTVCbWnYlzmCAjl5bbVCvzJjFreQ5rqg4yBgZGt2BVQeOB5xYQc70Hi03Yiqm/Xkl61FQJzJkNGghHJjVhac6yahqyhzqwHl7aocAmHlu/PtU3Vl9jvQZhaQCl76G3dzJtho06tr653p3168EyMwo2tGR5tNlXIRRSjn2TSNaWMzRgjVgsoG7Scr7TJwk+e06YYV1dtdtBcUEiWzEiUQhgjnrt/EVycP80zU5HPyZNWBpBEInj4kLc+vNx6F+QNbAwLM3bly80MCYgu4HygnLXb4SCUwOr31mbi4rFjvp9jD4ZmTixBjlFKJgmsChYFDChX18FJw6A6d36tmTa9Jjdvei+ChNFKhnmTxnX4dYQiSREdMFUgCVSHekLAhgzQQBjJghXbWaCcNVmJghXbWYBV21mgnDVRsBVm2UQwOCqnWoE31RFpBEAxiwAjFn4b00hUolAYNpcIlc56Qvi5i8zwVQG4SRSHekLwgadmeBGD9XexECTyEwQwJgJAhgzQQBjJojrMGaCAMZMMJWh2ojAQIYxEwQwZoIAxkwQwJgJwuCSmSAsZJkJwgadWcAGnZkgbNCZCeIcxkxQA+Yy1laWPV06XbTNbTv1Etu6cgxUHXQkaaziMtZWlt1qAhaYYco7a3NOKrTBSlu7FW91+HjY1jj1CregP/oBI421j9/du3QkfbQX2a6cEUba//Y3R4v901u/EcsP87LCrzk+sNAIBTtTN9Gm9crS0sgKy4mFsjk0n9hBHgmhKeuyQV81GGsf7ywXc+mjLTJMzEgj7V8f/OOf/+YnxfL3js4+OmgPrFfvdliy2iYaUedU2S8x75paQa5YF3CWq4CRxtrSz1f6aBdN4qJ02f6Tv/vFo2L56nB+cj30HKYA0+YGPqWrxAKm4WCN1GyymK13Qe6RlZpVUG5YZSgZ5jbWloykj3YFTLI9/dFPfv3HR3L56uR6Pk0bWBVWNbirR7fypaehYGe0INU4q1Ot2qpqJo21BSPpo312rzaoz/aFEfpO4bq9Wj38/pIpMBOcdWqiyGob+Os/GKwzZdVPEOM6rEjFOlIG5u0zmOWsJ0P4HvRgvrHdCWlqQ90YVT0LWHtj7eNsV5tnNWpqdPu9NYDn2jyVykNkmBEYW98YVMp6HktVBcbWMwsMJGUmyMIGvUO5jRVEhjETBDBmghg1xUwQwJgJYmw9s0CGMRMEMGaCAMZMEMCYCcIGnZkgbNCZCcIGnVlMaIOOSCVIYJoNOiKtgA06s4ANOrOASTOzADBmAVdtPhEITJtL5LI0fUHcS2QmiDEdzAQx8peZIEb+Mgs0icwEAYyZIIAxEwQwZoIjAHtx4dXt2V1rPwCsU7nhgb355MGzCy+v/M7cDwDrVG54YK8+ePL4av7H3A906zvFCBn281/deYAMiyU4xjls9vZ/3Xlg7QeAdSq3rTd/vVZQnd+57R5692R0YHkf8a8+SSXDPKYKZrlgQW85O56798QjOMI57P7dx3frcxjll0j6ecUNlzGQanNillOXOKd2QaI8VcC/R1P0Eu/WvUTKkbS5nqNFsw+Nvdza0Fu/PkupIHs4fcMpMuzF22WGUa7afhumLY5xu/XiHDZ7q7oMo1y1e+dOYLQ/vtulZMDy5tR0bThuhukxsat29fHraqBd3PQNfJ06S3i9wpxSnQtrV51vNMo5rPwjYmJXbbu6npsFiA2iXSdQ70xGU6fDY6vdAdib+0Uz/Lanlzhytz5csGf9OvQCjwBCkAK2ttVuHa4Mc8SW3umIBoy21d4/zsQq8ScvtLMsSwqjUvnn3b1Lj7JiKxew82diH9+yb/62+Zity6UrGKtJpG21xbKci/izyAntlyVrYDvLxa5S3sqwOw/ybv0Faz9wt75T1MAabLXXcB4erE6uL2rv5uqPnDY0ic+cX680HEahh1uEgtwE1QyjbLXXcKoMEyWFTXP5pxHYm08evLgAYLEE150O2lZ7DUyew2TJ05vZtbn84wN2/uLt/74/u2rtB4B1KretX6+wFbSBtbfV9gAzeokYNdVLcIQ7Hfq3zRhb309wpFtTdWBsfc8Y4Rz2WB+TiCaxl+AIGXa7PofBVbu/IIZqMxMcGtirD351G73EiIK4DmMmOHiG3S6+D8Pd+kiCI/UScbc+Vow9REABFuFwi1CQm+Aow9zEDWD8GCKO4EjD3GxeAJYqMIzpiCo4+r1EuGr3Exz7XiJctXsKjnovsQi4avcJuGoj6B9DwFU74SCuw+CqnWoQdzrgqp1qeO90INIK4gd9iFQDrtp8wgBGZBgunDuVw916ZoLjfx+GMR29BEfPMIz87Sc4tu0DRv72DIxLZCYIYMwEBwcmT2GPlUFTANZLcHBgj+VvLxVibmCWx1DPT5lK/UYXHH6o9hNlor2zNlcbYZEuUaNUR/qCQwN78/MwYIp7lx4egF2ro7VbxrYAO38mrsDe3Hf8KF3rrZJcLC86smSbzrFpascnhu8lvhCVYz9noLP9XjhB1+FKubYR5cgDnQ7uGUaGt5fYlWATQNMljwJnuegBWKdufe8UrGflhAZnAwu23waw5nLdCFbgjGmTT2UosQ0B9r8j+iU2w3MQ/NQybi3nz8NPeq0/SarAXn5L2BY9fmtaR1I3uIBGlEpB2oGUObA39+++uvMP9+u79ZSr9vjRkIEOgkQbKqej7vYYdzqeKdZglKt2En2wcIK2OXYZ3fcwkUd5SGDKrd+JXbXblnPwc54FZ0oBfep9Z7Jf6t7DUYAptzkmdtXuLWj0SrRMc0K0rgsdgurUt4c2MMXtN8tKZ+2TPae1tmKvGApsalft3oKu6zPi3Eb0Y+yULXQiAKtfKfaV7qI0sC2xfTDr3TrH0RlongxrRecba8AoZ+2TvYsHJ3uFD2npqi1nRYblixRHbQsYHZsNzPXcq1ZtqDKvvZEGzHDWFk1iASPPsKdL4fk7L5rB4105K17ni85+6wW2+c/ArHr3Zi+/nBf1r72Q04AUrDcsQwPmctauVuR5lc0Pc4S7spScLTPMsC8NBdbi+G1fLjVBJfOar7xdGaiuNzNMddbWgD08WB3OKwf0k3f+9kAaassixqkMwFxRV7vnq1MfUL3ToTtry17i/ukt0fqJmfdFOmX7RSkxK5vELOQcBmChBe3e4sjXYVvSS4wn2OkZmL2ctTEucUjB0b8Pw9j6foJjDyTF2PqekcpA0kSO3/QFRx1IClft/oLjDyQFsF6C4w8kBbBegqkMJE2kOtIXZD/MrW9BboITApu6g8wzkGHMBAGMmSCAMRMEMGaCYwODq3ZPwbGBwVW7p+AETSJctfvEhK7aEQ63CAW5CY4KTHPVns7PEWEECewcrtrpBgEMrtqpRuhvuBGJBIAxC7hq84lAYNpcIp3m9AVxL5GZIBxJmQli5C8zwdHv1mPkb79Ak8hMEMCYCQIYM0EAYyaI6zBmggDGTHBbR/4OZpo3tBtfKhlGWTG1DOq4NIM0V7B+Eu4rQFnN+h1nAzOs0faBPTBvEA5PxlTl02zD3WRV5KpvEgQVjcYqEwJzWS81RWdejaBsq662G2jTJnC2H4dFKmlgXWp+uIgEzHUEEHbQlrGiuuGUwCi/xLbAOoZZTUS1DXs4eIjqezo1sIkdSauPb06NcBiJmolAJETAkdI6tF0bG9jUrtq2G15cYXq1y36vYUrF2MBScdUe/XFUZreT6lbaOT/thTMzV+0BBM1DxfvoiWmBcXfVji5ogeoBzGXX7J4PB8beVTu2oNkE9mkSaWCNgZu/rQp6H6MUBIzw184X7yzzhY8cZtoAFkewW5No+muXwBb7+f98octMuzWw/l3pbQwCGOGv/fBgdXJdwHSYaSPDRhGkM8zlr11k2P7KZaYNYKMIUp0O21979/TWsjiHCWC2mTaAjSKYyt36RKojfUEfsA7+2hg1NaQgxtYzE8TYemaBgaTMBEf36QCwfoLIMGaCAMZMENdhzAQBjJngto6tZxvIMGaCAMZMEMCYCQIYM0G4ajMThKs2M0G4ajMLuGozE4SrNgKu2iwDrtrMAibNzALAmAVctflEIDBtbqxOs/fHPb3feZO69fo7R9j71gWpXxj7HImCrYva7yH5y0u34JaN6aB+Ak6CpDYkC5ocfHvoMaCwPsmWjfz11btdfZ4CFDD6N+ZEQcch4vwk2zby1/TpcC9X/VOCTak0wxVyfWhBZV7b0VSaxCYXmQGirg57BVHQU8/O6SxSTJlhAwOLVUVxwgGydWqKaYrA4lVRMFituhpK6tM2gsUHqz7g+oO6pkpNuKeJAQut6UhhHed62Htt1atdoHzh6xYRvRk6pu7W1++szUUCQX1Mqtr81VWXD73CDuzH1oItL+xSATbVfYTgGx2x74hQR4C9PBlgo3Tj0w3CZU8Aa9ps2zMsPUE0iZslCGDMBAGMmWAqrtqJVEf6gnAkZSa4ba7a7GNbXbXZCsJVm5kgzmHMBNFLZCboAuZ30y6Xu1fjOmxIwW7AGgPAhhQ0gBH259L5fLWYH7+7d+lRUSKTE5cbOu7WDxkGMML+XDqfC2A7y8WumIoSYuJyQ0eGDSloACPszwsjbUGompYTlxs6gA0paGeYy/68AHVoA1s5znMANqSg2elw25/n83kuXbOBudzQAWxIwVRGTSVSHekLUsA62J+HAYOrdj/BbRtbzz7QJDIThKs2M0FkGDNBAGMmiFFTzAQBjJkgxtYzC2QYM0EAYyYIYMwEAYyZIFy1mQnCVZuZIFy1mQVctZkJwlUbAVdtlgFXbWYBk2ZmAWDMAq7afCIQmDaXSKc5fUHcS2QmiDEdzAS3zFWbvyBG/jILNInMBAGMmSCAMRMEMGaCuA5jJghgzAQx8nfqaDbRtgIZNpUg9cg5uGo7I/jJG63fObAc9QwW+4kRAHYe9Dw2awt9ai6nylHPZvQBo/Zw24AR1RXAoeHRfg1P4bGeemSsCHpmk7ojW+KXaNZn8PPxmkDECO8eTQ2MciTt91Cj4IhVzzNXvapT13PcinqZGTntaVOnBka5ao9Y20317KhvOwG03rj5UE3fM3DqF4Fhlk/FVTu0pvuGccDXxy99vFdLnrsLmInhOXm2759O3OmgXLU7E6A+Z2C33ttLbN3/37A7HXDV7im4Jb3EzRFUga2tKqWX27667OlSKfh0qbparu0VA4Ap7xxh7yMU5CZIALu+Wp19pJjvnd5aEjO2JSmADSlYAjPctNfASv/sRbZ7ejPbWUoX7XymXJxnYmFgqrpr4279kHG5zhLVTVttEqV/dp5Ui/mqdNGWnrJycd5QFn6yqrs2MmxIwRKY4aadZ9jJO8v6BCWBHUr/X+GiXQATi/PEzOZlhtX2pQA2pOA6w1Q3bdEkFtm2BiaZyiVrYA8PpNW27q4NYEMKVp0O3U1bAFsd7qupJJIrK1y085nKVjvL3t+XTWLW/hwWYe8jFOQmiFFTzARNYD3ctMOAYWx9P0GMrWcWaBKZCcJVm5kgMoyZIIAxE9y2UVPsBQGMmSDG1jMLZBgzQQBjJghgzAQBjJkgXLWZCcJVm5kgXLWZBVy1mQnCVRsBV22WAVdtZgGTZmYBYMwCwJgFbND5RCAwbS6Rq5z0BXHzl5ngtg7C8ToMdX7nTQM28VBtj9OTWW6CPfSU27Kh2pVNCTW1fFKULQfbpVbFt6xJpAxVAjIu0EWs7R56rV2mbhIJYDFcbgLCsiYylpdTBZjH/s0iW9VvqGMLeagk45foBhZiXTRekG55rczAXEdGo2sbIZwksF550yJ8jlVxzfUixbTA6nfW5hLpg9lhtkzE9UBVr74p3fQFnk0BLI5gKAeveS0lUAWGakcKwz+RXO/txnvWI8OYCQIYM0EAYyYIYMwEYXDJTBAWsswEU7FBRwRGKjboiRy/6QumYoOeSHWkL4hzGDNBBZhitnyYZbs6hdpLsS6lW2uHAkMvsaegE5gwIz2cNwMzrLVDgSnvHGHvIxTkJlgAM0213ylhnN68+ON5bZ2dl9rJ0+pwXyCV1trldsJjdm2rDWBDCl6u0kY11V4dZzma1Up6xyrW2TkZYcj83tHZR7VTs9guX6/Yam/n3fqxogBmmGrLReL1wwPVOjufO7melzmcn1xfSWDldkWGVT6myLAhBesMU021F7slsBzI4do6u8ywnFq+qMowsV1xwqu2BrAhBctOh26qLXqJO8scSZ4319bW2eU5LE+87y9X0lpbbicLKbbaADakYPN1mMwwa2l+XmvaCMCGFDSAGaba8nkrJpBj8xqtHbA0xtazFdy2sfXsBbdsbD3/SGUgaSLHb/qCsEFnJogMYyYIYMwEMWqKmSCAMRPE2HpmgQxjJghgzAQBjJkggDEThA06M0HYoDMThA06s5jQBh2RSpDANBt0PS67FvaJLRTsFy1t0NOvjvQF+wVs0JkFTJqZBYAxCwBjFm2ArX80Finyy/OYmvL2TExBqRX9U/eLNsDWP8uME2LsY0xNeXsmpmCu9fkvY3/qntEG2PqHz1FCjn2MrPnNx3EFf/8vX0Tew77RBtjnsXc9BxZX8/XPvo4q+PqnP4z/qfvFhBkmgUXVFLdnYqfsh4wzLHpr/lXcc5i8PRP5pPhN1JNihNikXqK8PRO5l/iDrxn3EhEJBIAxCwBjFgDGLACMWQAYs+AI7OWV3029C9MFgDELBsBefmv21pPHV8/PX1woXufAXsxmF6rV37udv86Xvfnkwcvv/sXsj+7Prk66v8NG+sBe3Xlw/uzCy+88eXP/bvn6ypd5jj2+W6zP17z64EkJ7Nvy/yZnYPrAiurPaeUvitcvr/yneFbN1Xq9QFX9rUttaHABlreHz66e18AuaOsLVHn6AVgCIZrBF2/nOL77pHz95ZUvv/0gT7lifQnsO0+KxhDAJg/Z0TjPz13Va6PTIYGdP5794V8CWEIhoCD4AHsxu2AuyrMtjz/YMo5cgCHKADBmAWDMAsCYBYAxi/8Ho6lUk/bhnxcAAAAASUVORK5CYII=" width="50%" style="display: block; margin: auto;" /></p>
<p>There are two things I look for in these plots. First, the data
should look linear in this space. If the data does not look linear then
there are a few options: (a) something went wrong in your calibration
experiment, (b) something is wrong with your code for plotting the
calibration data, (c) our theory and prior experiments are wrong and PCR
bias is not well approximated as log-ratio linear. Second, you should
look to make sure your model is doing a good job fitting the data. Just
remember the data here has a<br />
few other sources of variation that the model is accounting for but not
plotting. For example, there is batch variation (think about the PCR
machine variable we included above). There are also zeros; here we just
add a pseudo-count and transform the data, internally <em>fido</em> is
actually modeling the zeros which should be more appropriate than the
pseudo-count.</p>
</div>
<div id="using-maximum-marginal-likelihood-to-estimate-a-scale-of-gamma" class="section level1">
<h1>Using Maximum Marginal Likelihood to estimate a scale of Gamma</h1>
<p>Above I chose my prior for gamma to be a diagonal matrix multiplied
by a factor of 10. How did I choose 10? In the manuscript I used
something called maximum marginal likelihood. Essentially I refit the
model for different values (not just 10) and saw which one fit the data
best (which one had the highest marginal likelihood). Here is an example
of how this can be done. What you will notice is that essentially the
model tells us that you just want a really big value of sigma. Why? This
actually corresponds to a situation where the multinomial alone is
enough to explain the variation between technical replicates. This
happens occasionally. We also see that the log marginal likelihood
pretty much assemptotes around 10. So rather than picking 100000, I just
settled for 10 as this would be both more numerically stable and just
seemed more reasonable. The model basically just says: “don’t choose a
value less than 10”.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>) <span class="co"># candidate values</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>lml <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(sigma)) <span class="co"># log marginal likelihood</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(sigma)){</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">pibble</span>(<span class="at">Y=</span>Y, <span class="at">X=</span>X, <span class="at">Gamma =</span> sigma[i]<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(X)))</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  lml[i] <span class="ot">&lt;-</span> fit<span class="sc">$</span>logMarginalLikelihood <span class="co"># this is calculated automatically by fido</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>}</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">plot</span>(sigma, lml)</span></code></pre></div>
<p><img src="https://github.com/jsilve24/fido/raw/master/vignettes/pcr-max-lik.png" width="50%" style="display: block; margin: auto;" /></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
